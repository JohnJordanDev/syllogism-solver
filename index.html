<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syllogistic Inference</title>
    <style>
        /*https://stackoverflow.com/questions/5805059/how-do-i-make-a-placeholder-for-a-select-box */
        select:required:invalid {
            color: gray;
        }
        option[value=""][disabled] {
            display: none;
        }
        option {
            color: black;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <section>
        <header>
            <form action="#" onsubmit="return false;" id="first_figure">
                <fieldset>
                    <legend>Proposition I:</legend>
                    If
                    <select id="prop_one_quantity" required>
                        <option value="" disabled selected>all/some/no</option>
                        <option value="all">all</option>
                        <option value="some">some</option>
                        <option value="no">no</option>
                    </select>
                    "M"
                    <select id="prop_one_quality" required>
                        <option value="" disabled selected>are/are NOT</option>
                        <option value="are">are</option>
                        <option value="arenot">are NOT</option>
                    </select>
                    "A".
                </fieldset>
                <fieldset>
                    <legend>Proposition II:</legend>
                    And, If
                    <select id="prop_two_quantity" required>
                        <option value="" disabled selected>all/some/no</option>
                        <option value="all">all</option>
                        <option value="some">some</option>
                        <option value="no">no</option>
                    </select>
                    "B"
                    <select id="prop_two_quality" required>
                        <option value="" disabled selected>are/are NOT</option>
                        <option value="are">are</option>
                        <option value="arenot">are NOT</option>
                    </select>
                    "M".
                </fieldset>
                <input type="submit" value="Conclusion">
            </form>
            <output id="conclusion" for="prop_one_quantity prop_one_quality prop_two_quantity prop_two_quality" form="first_figure"></output>
        </header>
    </section>
    <script>
        var validMoodsFirstFigure = {
            "AA": "A",
            "EA": "E",
            "AI": "I",
            "EI": "O"
        };
        var formOfPropositions = {
            "allare": "A",
            "noare": "E",
            "someare": "I",
            "somearenot": "O"
        };
        var validConclusions = {
            "A": "All 'B' are 'A'",
            "E": "All 'B' are NOT 'A'",
            "I": "Some 'B' are 'A'",
            "O": "Some 'B' are NOT 'A'"
        };
        var getFormOfPropositions = (prop1Quantity, prop1Quality, prop2Quantity, prop2Quality) => {
            var prop1Form = formOfPropositions[prop1Quantity + prop1Quality];
            var prop2Form = formOfPropositions[prop2Quantity + prop2Quality];
            return prop1Form + prop2Form;
        };
        var getConclusion = (formOfBothPropositions) => {
            var conclusion = validMoodsFirstFigure[formOfBothPropositions];
            if(typeof conclusion !== "undefined" && typeof validConclusions[conclusion] !== "undefined") {
                return validConclusions[conclusion];
            }
            return "We cannot draw a valid conclusion";
        };
        var conclusion = window.document.getElementById('conclusion');

        var hideAreNotOptionOfPropQuality = propQualityId => {
            var propQualityElem = window.document.getElementById(propQualityId);
            propQualityElem.value = 'are';
            console.log('calling hiding', propQualityElem);
            propQualityElem.querySelectorAll('option').forEach(optionElem => {
                if(optionElem.value === 'arenot'){
                    optionElem.setAttribute('disabled', 'disabled');
                    optionElem.setAttribute('selected', 'false');
                } else if(optionElem.value === 'are') {
                    optionElem.setAttribute('selected', 'true');
                }
            });
        };

        // Only valid quantity given quality of 'are NOT', is 'some'
        var selectSomeOptionOfPropQuantity = propQuantityId => {
            var propQuantityElem = window.document.getElementById(propQuantityId);
            propQualityElem.value = 'some';
        };

        // showAreNotOptionOfPropQuality(), to undo effect of hideAreNotOptionOfPropQuality
        var showAreNotOptionOfPropQuality = propQualityId => {
            var propQualityElem = window.document.getElementById(propQualityId);
            propQualityElem.querySelectorAll('option').forEach(optionElem => {
                // Want to maintain disabled status of 'placeholder' element
                if(optionElem.value === 'arenot') {
                    optionElem.removeAttribute('disabled');
                }
            });
        };

        window.document.addEventListener('change', e => {
            var elem = e.target;
            var elemId = elem.getAttribute('id');
            console.log('elemID', elemId, elem.value);
            if(elemId === 'prop_one_quantity' || elemId === 'prop_two_quantity') {
                if(elem.value === 'no' || elem.value === 'all'){
                    hideAreNotOptionOfPropQuality(elemId.replace('quantity', 'quality'));     
                } else {
                    showAreNotOptionOfPropQuality(elemId.replace('quantity', 'quality'));
                }
            }
            if(elemId === 'prop_one_quality' || elemId === 'prop_two_quality') {
                if(elem.value === 'arenot'){
                    selectSomeOptionOfPropQuantity(elemId.replace('quality', 'quantity'));    
                } else {
                    //
                }
            }
            // need to add listen handler to reset value of prop quantity, if quality is set to 'are not', to disable 'no' option of quantity
        });
        window.document.addEventListener('submit', e => {
            var prop1Quantity = window.document.getElementById('prop_one_quantity').value;
            var prop1Quality = window.document.getElementById('prop_one_quality').value;
            var prop2Quantity = window.document.getElementById('prop_two_quantity').value;
            var prop2Quality = window.document.getElementById('prop_two_quality').value;
            var formsOfPropositions = getFormOfPropositions(prop1Quantity, prop1Quality, prop2Quantity, prop2Quality);
            e.preventDefault();
            console.log('form submitted...', formsOfPropositions);
            conclusion.innerHTML = getConclusion(formsOfPropositions);
        });

    </script>
</body>
</html>